# MP4 转 HEIC 相册服务产品需求文档 (PRD) V2.0

## 1. 产品概述
MP4 转 HEIC 相册 Web 服务是一个高效的视频帧提取工具。用户上传 MP4 视频后，系统利用硬件加速提取视频帧并转换为 HEIC 格式，生成沉浸式相册供浏览与下载。V2.0 版本重点优化了批量处理能力、下载体验及 UI 交互细节。

## 2. 核心功能

### 2.1 用户角色
- **普通用户**：无需注册，直接上传视频、管理相册、按需下载图片。

### 2.2 功能模块
#### 2.2.1 首页 (Home)
- **拖拽上传**：支持 MP4 文件拖拽或点击上传，支持大文件（默认 2GB）。
- **下载设置 (New)**：右上角配置“本地下载目录”，支持静默保存至宿主机物理路径，避开浏览器弹窗。
- **状态追踪**：分阶段展示“上传进度”与“处理进度”，通过节流优化确保进度条平滑增长。

#### 2.2.2 相册页 (Album View)
- **瀑布流展示**：按帧序号排列，支持滚动懒加载。
- **多选管理 (New)**：
  - 每张图片带悬浮复选框。
  - 支持“全选/取消全选”功能。
  - 支持对选中项进行批量下载。
- **下载模式切换 (New)**：
  - **帧号命名**：格式为 `frame_X_of_Y.heic`。
  - **时间戳命名**：格式为 `HH-mm-ss-SSS.heic`。
- **全额下载 (Optimized)**：支持将整个相册打包成单压缩包 (ZIP) 下载。

#### 2.2.3 详情预览页 (Detail Preview)
- **沉浸式浏览**：黑色半透明背景，图片居中展示。
- **自适应对齐 (New)**：工具栏宽度根据图片分辨率动态适配，确保视觉对齐。
- **键盘导航 (New)**：
  - `⬅️/➡️` 方向键：翻页。
  - `ESC` 键：退出预览。
- **快捷操作**：显示当前帧号及视频精确时间戳，支持单张快捷下载。

## 3. 核心流程与交互

### 3.1 下载逻辑流 (CR 增补)
1. **优先本地保存**：若用户已在设置中配置有效“本地下载目录”，点击下载将通过后端直接将文件写入该目录（无感保存）。
2. **回退浏览器下载**：若未配置路径，单张下载触发浏览器保存对话框；多选下载（超过 10 张）将提示建议配置路径，或循环触发浏览器弹窗。
3. **ZIP 归档**：全额下载始终采用 ZIP 流式压缩方案。

### 3.2 技术约束
- **输入**：MP4 格式，建议 H264 编码。
- **输出**：HEIC 格式（质量 80），自动生成缩略图（_thumb.jpg）提升列表加载性能。
- **加速**：支持 Intel Arc A380 硬件加速。
- **持久化**：使用 PostgreSQL 记录任务与图片元数据，支持跨重启访问。

## 4. UI/UX 规范
- **布局**：卡片式布局，响应式适配（桌面 4-5 列，移动端 2 列）。
- **风格**：深蓝搭配纯白，沉浸式预览模式使用 `backdrop-blur` 和 `opacity`。
- **性能**：首屏加载时间 ≤ 3s，大图预览加载 ≤ 2s。
